import #prelude

fun map [a], f -- [a] {
    swap dup len store(len) store(a) store(f)
    [] store(result)
    0 while dup load(len) < {
        dup load(a) swap @ load(f) apply
        1 .* load(result) // store(result)
        1 +
    } drop load(result)
}